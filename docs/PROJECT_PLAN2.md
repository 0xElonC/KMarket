## 1. 项目概述

### 1.1 核心理念：万物皆可线

**将任何可量化的事件数据转化为连续的 K 线图，让用户像交易加密货币一样预测万物走势。**

KMarket 是建立在 Polygon 区块链上的去中心化预测市场协议。我们的核心创新在于：**任何可以被量化、被追踪的数据，都可以被"线图化"**——无论是加密货币价格、政治选举民调、体育比赛数据、还是社交媒体热度，都能以统一的 K 线形式呈现，让用户用熟悉的交易方式参与预测。

不同于传统预测市场的"是/否"二元结果，KMarket 创新性地引入了类似 Uniswap V3 的"Tick（刻度）"机制，允许用户对未来特定时间段内的**数值区间**进行精准预测，实现更丰富的策略维度和更高的潜在回报。

### 1.2 万物线图化：应用场景

#### 🏛️ 政治事件 K 线化
| 事件类型 | 数据指标 | 预测周期 |
|---------|---------|---------|
| 选前民调 | 候选人支持率、选举人票预测数 | 日/周 |
| 选举夜计票 | 实时得票数、各州开票结果 | 分钟/小时 |
| 国会投票 | 法案支持票数、通过概率 | 小时/日 |
| 总统支持率 | 盖洛普民调指数 | 周/月 |

#### ⚽ 体育事件 K 线化
| 运动类型 | 数据指标 | 预测周期 |
|---------|---------|---------|
| 足球 | 比分、控球率、xG（预期进球） | 分钟/半场 |
| 篮球 | 单节得分、球员数据、分差 | 节/场 |
| 电竞 | 击杀数、经济差、推塔数 | 分钟/局 |
| 赛车 | 实时排名、圈速、进站策略 | 圈/赛段 |

#### 📊 经济与金融事件
| 事件类型 | 数据指标 | 预测周期 |
|---------|---------|---------|
| 宏观数据 | 非农就业、CPI、美联储利率决议 | 月/季 |
| 公司财报 | 营收、EPS、用户增长 | 季度 |
| 加密货币 | BTC/ETH 价格、Gas 费、TVL | 秒/分钟/小时 |

#### 🎬 社交与文化事件
| 事件类型 | 数据指标 | 预测周期 |
|---------|---------|---------|
| 社交媒体 | 粉丝数增长、视频播放量、话题热度 | 小时/日 |
| 娱乐产业 | 电影票房、音乐榜单排名 | 日/周 |
| 颁奖典礼 | 获奖预测、赔率变化 | 事件前 |

### 1.3 市场痛点

当前预测市场和衍生品市场存在明显局限：

- **预测市场过于简单**：Polymarket 等平台仅支持"是/否"二元结果，无法捕捉数值变化的精细程度。
- **衍生品风险过高**：永续合约的高杠杆和爆仓机制让普通用户望而却步。
- **数据孤岛严重**：政治、体育、娱乐等领域的预测分散在不同平台，缺乏统一的交易体验。
- **流动性激励不足**：传统平台往往是用户与庄家对赌，缺乏透明的流动性提供机制。

### 1.4 解决方案

KMarket 提出了一套**通用的数值区间预测框架**：

- **万物线图化引擎**：将任何可量化数据转化为标准 K 线格式，提供统一的交易界面。
- **Tick 区间预测**：用户预测数值将落入哪个区间，而非简单的涨跌方向。
- **动态赔率机制**：赔率根据市场供需和概率模型自动计算，距离当前值越远，赔率越高。
- **去中心化流动性池**：LP 可以向特定区间注入流动性，获得手续费和失败预测的本金分红。
- **无爆仓风险**：最大损失仅限于下注本金，不会因数据波动而被强制平仓。

### 1.5 核心特性

1. **万物皆可线**：统一的数据线图化引擎，支持任意可量化事件。
2. **Tick 区间预测**：精细化的数值区间划分，提供丰富的策略维度。
3. **动态赔率系统**：距离当前值越远，潜在回报越高。
4. **多周期支持**：从 30 秒极速市场到月度长线预测，满足不同需求。
5. **链上透明结算**：所有数据上链，结果由预言机自动判定。

### 1.6 目标用户

- **加密货币交易者**：寻找新型博弈工具的 DeFi 原生用户。
- **体育博彩爱好者**：希望用更透明、更灵活方式参与体育预测的用户。
- **政治/时事关注者**：对选举、政策等事件有独到见解的预测者。
- **流动性提供者**：寻求比传统 AMM 更高收益率的 DeFi 挖矿者。
- **量化交易团队**：利用概率模型进行套利和对冲的专业机构。

## 2. 核心机制设计

### 2.1 数据线图化引擎

**万物皆可线的技术实现**：

```
┌─────────────────────────────────────────────────────┐
│                   数据源层 (Data Sources)            │
│  - 加密货币: Chainlink, Pyth, Binance API           │
│  - 政治民调: RealClearPolitics, 538                 │
│  - 体育数据: ESPN API, Opta                         │
│  - 社交媒体: Twitter API, YouTube API               │
└──────────────────────┬──────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│              线图化引擎 (K-Line Engine)              │
│  - 数据标准化 & 归一化                               │
│  - 时间粒度聚合 (秒/分/时/日)                        │
│  - K 线生成 (开/高/低/收)                            │
│  - Tick 区间划分                                    │
└──────────────────────┬──────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│              预测市场层 (Prediction Market)          │
│  - 区间下注 & 赔率计算                               │
│  - 流动性池管理                                     │
│  - 自动结算 & 分红                                  │
└─────────────────────────────────────────────────────┘
```

### 2.2 价格区间（Tick）机制

借鉴 Uniswap V3 的设计理念，将数值空间划分为离散的 Tick：

- **基础区间**：根据数据类型设定最小 Tick 单位（如价格 1%、得分 5 分）。
- **当前值锚点**：以市场开启时的数据值为基准。
- **Tick 编号系统**：正数表示上涨区间，负数表示下跌区间。

**示例：ETH 价格预测**
```
当前价格: $2900
Tick +1: $2929 - $2958 (+1% ~ +2%)  赔率 1.3x
Tick +2: $2958 - $2987 (+2% ~ +3%)  赔率 1.6x
Tick +3: $2987 - $3016 (+3% ~ +4%)  赔率 2.0x
Tick -1: $2871 - $2900 (-1% ~ 0%)   赔率 1.3x
Tick -2: $2842 - $2871 (-2% ~ -1%)  赔率 1.6x
```

**示例：足球比赛总进球预测**
```
当前预期: 2.5 球
Tick 0-1: 0-1 球  赔率 2.5x
Tick 2-3: 2-3 球  赔率 1.8x
Tick 4-5: 4-5 球  赔率 3.0x
Tick 6+:  6+ 球   赔率 8.0x
```

### 2.3 赔率计算公式

**基础赔率模型**：
```
赔率 = 1 + (基础利率 × 距离系数 × 流动性调整系数 × 时间风险系数)

其中：
- 基础利率：固定参数，例如 0.3 (30%)
- 距离系数 = |Tick 编号| × 距离权重
- 流动性调整系数 = 总流动性 / (Tick 流动性 + epsilon)
- 时间风险系数：时间越短，波动越剧烈，系数越高
```

### 2.4 市场周期设计

根据不同事件类型，支持多种时间周期：

| 市场类型 | 周期 | 适用场景 |
|---------|------|---------|
| 极速市场 | 30秒、1分钟 | 加密货币高频交易 |
| 短时市场 | 5分钟、15分钟 | 体育比赛实时预测 |
| 常规市场 | 1小时、4小时 | 日内趋势判断 |
| 日线市场 | 1天 | 民调、票房等日度数据 |
| 事件市场 | 自定义 | 选举、财报等特定事件 |

### 2.5 流动性提供机制

**LP 收益来源**：
1. **手续费收入**：每笔下注收取 2-3% 的协议手续费。
2. **对手方收益**：用户预测失败后的本金注入流动性池。
3. **时间衰减费**：对长期未提取的闲置奖金收取管理费。

**LP 风险控制**：
- 设置 LP 资金锁定期
- 建立风险准备金池
- 限制单边最大投注额度
- 极端行情熔断机制

## 3. 技术架构

### 3.1 整体架构（Layer 2 混合模式）

为满足高频预测需求，采用 **"链下撮合、链上结算"** 的混合架构：

```
┌─────────────────────────────────────────────────────┐
│                    用户端 (Client)                    │
│  - 钱包签名 (EIP-712)                                 │
│  - 实时 WebSocket 交互                                │
│  - 统一的线图交易界面                                  │
└──────────┬───────────────────────────────▲──────────┘
           │ (1. 签名下注)                   │ (2. 状态更新)
           ▼                               │
┌─────────────────────────────────────────────────────┐
│                 链下定序器 (Sequencer)                │
│  - 撮合引擎 & 风险控制                                 │
│  - 虚拟账本 (Virtual Ledger)                          │
│  - 多源数据聚合 (Chainlink/API/爬虫)                   │
│  - 线图化引擎                                         │
└──────────┬───────────────────────────────▲──────────┘
           │ (3. 提交结算根 / 提现凭证)       │ (4. 验证存款)
           ▼                               │
┌─────────────────────────────────────────────────────┐
│                Polygon 链上合约层                     │
│  - 资金托管合约 (Vault)                               │
│  - 验证与结算合约 (Verifier)                          │
│  - 流动性池合约 (LP Pool)                             │
└─────────────────────────────────────────────────────┘
```

### 3.2 智能合约架构

#### 核心合约模块

1. **LiquidityVault.sol (资金库)**
   - 负责充值（Deposit）和提现（Withdraw）
   - 维护 LP 资金池和用户托管资金
   - 只有持有有效"提现凭证"的请求才能转出资金

2. **MarketVerifier.sol (验证器)**
   - 验证定序器的签名
   - 处理用户的"强制提现"请求（防止定序器作恶）
   - 记录状态根用于数据可用性检查

3. **LPManager.sol (流动性管理)**
   - LP 存入资金铸造 LP Token
   - 计算协议层面的盈亏分红

### 3.3 前端技术栈

- **框架**: React + Vite
- **区块链交互**: viem + wagmi + RainbowKit
- **图表库**: Canvas 自研 K 线引擎
- **UI 组件库**: Tailwind CSS
- **数据同步**: WebSocket 实时推送

## 4. 竞争分析

### 4.1 竞品对比

| 特性 | KMarket | Polymarket | Augur | 传统体育博彩 |
|:---|:---|:---|:---|:---|
| **核心理念** | 万物皆可线 | 事件二元预测 | 事件二元预测 | 固定赔率 |
| **预测精度** | 数值区间 | 是/否 | 是/否 | 固定选项 |
| **支持领域** | 全领域 | 政治/社会 | 政治/社会 | 体育 |
| **市场周期** | 秒级~月级 | 事件驱动 | 事件驱动 | 事件驱动 |
| **流动性模式** | AMM 池 | 订单簿 | AMM 池 | 庄家对赌 |
| **透明度** | 链上透明 | 链上透明 | 链上透明 | 不透明 |

### 4.2 差异化优势

1. **万物皆可线**：首个将任意可量化数据统一线图化的预测平台。
2. **区间预测创新**：相比简单的二元预测，提供更丰富的策略维度。
3. **全领域覆盖**：打破数据孤岛，政治、体育、娱乐、金融一站式预测。
4. **低门槛高赔率**：小资金博取高回报，无爆仓风险。
5. **去中心化透明**：所有数据上链，避免暗箱操作。

## 5. 开发路线图